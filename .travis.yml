sudo: false
services:
- docker
env:
  global:
  - PLUGIN_NAME=linz-data-importer
  - IMAGE=elpaso/qgis-testing-environment
  - secure: e4Z0yuDAaTUrnLJhmWaubKIQkwRyBOJBmdEAAevnVmztlkZ25yM6Cu3+VCORR62cYO0U5PTIogmWAHWJCf27qTk0n3MLv701FFr0Rzvz2qiU3kJ4z2Tjhl+fqvFmnOLF7JBAlmG5J3mzKiCBmLtVFLMuNJ4zq0GmU014ODaMFHaDS5u3DRlyr0jI9C0V62ruCD32zWVh50/oJsBYvH1H+GC65FDw5LGU9hpI5WEQsfYMYgl6vrMv5+XOJBSqPnRORM6AId1Ytzz7pei3RN6/oBiA+wGVSn4Fp1/Ags47Fl97U2wtmvU6/+56O16xexIBy7/iCS09FlR0v7i0ZZEI+wg4jTIG34OrLCFBtO3fNVpmXOPPp0EC08EuTi3DDYeWiH6V8reN5oi4b5VkybYTH1SXf28zRnYxwUSyAHa8ByU/MIGsSOQvT1wRBw2vkxDGSxrcXmoBAl6bBEtcrVTmnZ6JTysKSNsvBnRSl+aZbur0VnXrF084IZFWxp9SSniA59HkpHUxR/41FYf6SjiH1Fckea7ggQwGRZIqfwXkcfsAl/Dd69yfTLoL+nN5NLrrt3w2xNdhyNMnn6gOrXGq0+kDtZrl9WUM5qNUI/NcnIbtlSBQuKfnGVcLafo/31fHDgbsWlpKrCG0mIqqGNQpr9DywbnBxV+jzf/Sdy55FDM=
  - secure: OxQHp+k1TUbrHri6wckMVKNdsBm36YXC/YpuuPMULoRQ2PTQMfs3fD4uiZpzMn3HiFi6Yi2ca+pwtjWQvndkkq1GhzLUbBPUHnjSQgwxqPMgv9j43TpF3QgPYSb3f0tR7QqVWoGUcKkONp6UbDAPvILOQqe27Le8xmhSbHIznf0fWFsYW+f3C0McDkTpfTqpsxLdmD8rgrTLxTNG3szChT4eWYM3Qa6q1yfiKthOxn00bkVDpNInfgTOKzPe4OXzthU7JnTePgQFaSpnZfFxQMNRYC4gEcqi3VE877BFmmjx2gkhlzeaZaeKQvljjmBzXZP3yF56qPbnHd1ihU14N8xUh0KolbUWtJ/owv7sC4UNbvGnTMbUpXteCvpAD8Z5g8wiA+0HAZYuNwj9edFZ2uuq9wEUYO8VaXjX3VoEE4wBF8fsXT12M8Ix+nWYxk18H46F1DuxQYO5jOCvII4ti8QQPuQtOugxbQL9Adge6OBFy7kGTvvv1QM64ytiJKHVOD3y14CzT4MjwkisLhj2KfLkDQAoe1onkCUkMp2rYC0cqBmW36v+qnZ3HUCPKss02AB9ZgRXW5oDF8Qb+C6ZEVHQWMJ/hL/FaXUNmWdPVKk+XDvKJJusI9/mXMk+GmxkcDWHOmGm6Vf6S+lcFLLkWHC0V8xSJMTI0MUwXu7cWPk=
  - secure: izd7gMzpfYR+inOQ8Z9jiJq90i4Ik2n1K78/9h1IHSInIPZgm6irT7SmXOk8bcZQL5E/8figbAnvZkvhi88lpILtM3whbuwKThI7+CRhPXe2c6hOarm01PQtHcZr/lT23GGQFSqU5Ckez1O4CUvhENV7UptBvEFjkWjOO9iOOTjDidTZVT7g5869wf8/mWDyQeu//I8BaJMKdt1FtuxjRytJ+b5flLJEDP5GRAQQmfYc211LYE515Na+BTZSxF+xXK/6mVBq+G+erNNIGP+CChTpEyC2fOjlMJwRvzBY4ZyKmpJCB0cdBj96DhxNnmXm3a/znVr0Xik3/jitUVbxkSRlQYfAnMgHgxw32n3hjxkasMNQzsJxHnKCz3kFQBaO1oqD3LV56++GGpIFbzXqPCRtbL+WJ9TAmcccoZdaYMnkz+vgyV3HWqlqgfBu1F0v9JP9kzAPF5N3W0C3QuRueMxL+S5UmtgwMCwgFpbxh91KfdhWj/FegDLUyrdpBbLgd66+SVD2qnPtucj9uZYgWXSz8CPlRHsKBcxrLjVkxP0duOAOVgZGcldqDkS+hPh4VEuZNsUCuM89ZaImGaiiU6tmuiV06vXD0RtdCGpX78OjiRUmaQvjoK3WHYAp8R+TmqLwiBIQPpoVxISp1CbA+XQq1mxsswP/UfbCzIGoEy4=
  matrix:
  - QGIS_VERSION_TAG=master
language: python
python:
- '3.6'
branches:
  only:
  - master_qgis3
before_install:
- docker pull ${IMAGE}:${QGIS_VERSION_TAG}
install:
- docker run -d --name qgis-testing-environment -v ${TRAVIS_BUILD_DIR}:/tests_directory
  -e LDI_LINZ_KEY -e LDI_MFE_KEY -e LDI_NZDF_KEY -e DISPLAY=:99 ${IMAGE}:${QGIS_VERSION_TAG}
- sleep 10
- docker exec -it qgis-testing-environment sh -c "qgis_setup.sh ${PLUGIN_NAME}"
- docker exec -it qgis-testing-environment sh -c "ln -s /tests_directory /root/.local/share/QGIS/QGIS3/profiles/default/${PLUGIN_NAME}"
script:
- docker exec -it qgis-testing-environment sh -c "qgis_testrunner.sh ${PLUGIN_NAME}.tests.run_tests.run_test_modules"
